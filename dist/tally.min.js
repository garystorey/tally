!function(t){"use strict";var s=function(s,i){this.el=s,this.$el=t(s),this._initialized=!1,this.init(i)};s.prototype={init:function(t){return this.type="Tally",this._setOptions(t),this.$el.data("Tally",this),this._events="focusin.tally focusout.tally keyup.tally keydown.tally input.tally paste.tally",this._buildTallyObject(),this._bindEvents(),this.$el},destroy:function(){this._initialized&&(this.$tally.remove(),this.$tally=void 0,this.$el.off(".tally"))},_setOptions:function(s){var i=this.$el.data("tally");this.options=t.extend(!0,{},t.fn.tally.defaults,s),i&&(this.options=t.extend(!0,{},this.options,i)),this.options.maxlength=this.$el.attr("maxlength")?this.$el.attr("maxlength")-0:this.options.maxlength-0,this.options.countDirection=this.options.countDirection.toLowerCase(),-1==="updown".indexOf(this.options.countDirection)&&(this.options.countDirection="up")},_bindEvents:function(){var t=this,s=t.options,i=t._events;t.$el.on(i,function(i){switch(i.type){case"focusin.tally":t.$tallyText.text(t._buildText()),t.$tally.addClass(s.classes.main),s.setPosition&&(t.$tally.css({position:"absolute",zIndex:s.position.zIndex}),t.$tallyBar.css({position:"relative",zIndex:s.position.zIndex+1}),t.$tallyText.css({position:"relative",zIndex:s.position.zIndex+2}),t._setXY()),t.$tally.show();break;case"focusout.tally":t.$tally.removeClass(s.classes.main+" "+s.classes.warning).hide(),t.$tallyText.text(""),s.setPosition&&(t.$tally.css({position:"static",zIndex:"auto"}),t.$tallyText.css({position:"static",zIndex:"auto"}),t.$tallyBar.css({position:"static",zIndex:"auto"}));break;default:t.$tallyText.text(t._buildText())}t._updateClasses(i),s.showProgressBar&&t._updateProgressBar()})},_updateProgressBar:function(){this.$tallyBar.css("background-width",this._getPercentage()+"%")},_fireEvent:function(t){var s="warning"===t?"tallyWarning":"tallyPass";this.$tally.hasClass(this.options.classes.warning)&&this.$el.trigger(s)},_hasWarning:function(){return this.$tally.hasClass(this.options.classes.warning)},_updateClasses:function(s){var i=t(s.target),e=s.type,a=this.options,n=a.warnAt,l=a.maxlength,o=a.classes,r=this._countChars(),h="up"===a.countDirection?!0:!1;return"focusout"===e&&i.removeClass(o.field),this._fireEvent(this._hasWarning()?"pass":"warning"),h?l-n>r?(i.removeClass(o.field),this.$tally.removeClass(o.warning),void 0):(i.addClass(o.field),this.$tally.addClass(o.warning),void 0):n>=r?(i.addClass(o.field),this.$tally.addClass(o.warning),void 0):(i.removeClass(o.field),this.$tally.removeClass(o.warning),void 0)},_buildText:function(){var t=this.options.pattern,s=this._countWords(),i=this._pad(this._countChars()),e=this._getPercentage(i,this.options.maxlength);return t=t.replace("{{c}}",i).replace("{{m}}",this.options.maxlength).replace("{{w}}",s).replace("{{p}}",this._pad(e,3))},_countChars:function(){return"down"===this.options.countDirection?this.options.maxlength-this.$el.val().length:this.$el.val().length},_getPercentage:function(t,s){return"down"===this.options.countDirection?100-parseInt(Math.floor(t/s*100),10):parseInt(Math.floor(t/s*100),10)},_countWords:function(){var t=this.$el.val();return t.match(/\S+/g)?t.match(/\S+/g).length:t?1:0},_buildTallyObject:function(){var s,i,e=this.options,a=t("#"+e.id);this._initialized||0!==a.length?(this.$tally=a,this.$tallyText=a.find("."+e.classes.text),this.$tallyBar=a.find("."+e.classes.progressBar)):(s=t("<div/>",{id:e.id}).hide(),this.$tally=s,i=t("<span/>",{"class":e.classes.progressBar,display:"block"}),i.appendTo(s),this.$tallyBar=i,i=t("<span/>",{"class":e.classes.text,display:"block"}).appendTo(s),s.appendTo("body"),this.$tallyText=i,this._initialized=!0)},_setXY:function(){var t=0,s=0,i=this.options.position.x,e=this.options.position.y,a=parseInt(this.options.position.offsetX,10),n=parseInt(this.options.position.offsetY,10),l=this.$el.offset().left,o=this.$el.width(),r=this.$el.offset().top,h=this.$el.height(),c=this.$tally.outerWidth(),p=this.$tally.outerHeight();switch(i){case"left":t=l;break;case"center":t=l+o/2-c/2;break;case"right":t=l+o-c+6;break;default:t=parseInt(i,10)}switch(e){case"top":s=r-p-8;break;case"center":s=r+h/2-p/2;break;case"bottom":s=r+h+7;break;default:s=parseInt(e,10)}"left"===i&&"center"===e&&(t-=c+13),"right"===i&&"center"===e&&(t+=c+12),"number"==typeof a&&(t+=parseInt(a,10)),"number"==typeof n&&(s+=parseInt(n,10)),this.$tally.css({top:s,left:t})},_pad:function(t,s,i){var e=this.options.maxlength+"";for(s=s||e.length,i=i||"0",t+="";t.length<s;)t=i+t;return t}},jQuery.fn.tally=function(i){if("string"!=typeof i)return this.each(function(){new s(t(this),i)});if(s=t(this).data("Tally"),null!==s)switch(i){case"init":s.init();break;case"destroy":s.destroy()}},jQuery.fn.tally.defaults={id:"tally",pattern:"{{c}}/{{m}}",showProgressBar:!0,warnAt:10,maxlength:256,countDirection:"up",classes:{main:"tally",text:"tally-text",progressBar:"tally-progressBar",warning:"tally-warning",field:"tally-fieldWarning"},setPosition:!0,position:{zIndex:100,x:"right",y:"bottom",offsetX:0,offsetY:0}}}(jQuery);