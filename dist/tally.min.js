/*! Tally - v0.5.0 - 2013-06-04
* Copyright (c) 2013 Gary Storey; Licensed MIT */
(function(t){"use strict";var s=function(s,e){this.el=s,this.$el=t(s),this.init(e)};s.prototype={init:function(t){return this._setOptions(t),this.$el.data("Tally",this),this._events="focusin.tally focusout.tally keyup.tally keydown.tally input.tally paste.tally",this._initialized=!1,this._buildTallyObject(),this._bindEvents(),this.$el},destroy:function(){this._initialized&&(this.$tally.remove(),this.$tally=void 0,this.$el.off(".tally"))},_setOptions:function(s){var e=this.$el.data("tally");this.options=t.extend(!0,{},t.fn.tally.defaults,s),e&&(this.options=t.extend(!0,{},this.options,e)),this.options.textfield.maxlength=this.$el.attr("maxlength")?this.$el.attr("maxlength"):this.options.textfield.maxlength},_bindEvents:function(){var t=this,s=t.options,e=t._events;t.$el.on(e,function(e){switch(e.type){case"focusin":t.$tally.addClass(s.tallyClass).css({position:"absolute",zIndex:s.position.zIndex}).show(),t.$tallyText.text(t._buildText()).css({position:"relative",zIndex:s.position.zIndex+2}),t.$tallyBar.css({position:"relative",zIndex:s.position.zIndex+1}),s.setPosition&&t._setXY();break;case"focusout":t.$tally.removeClass(s.tallyClass).removeClass(s.warningClass).css({position:"static",zIndex:"auto"}).hide(),t.$tallyText.text("").css({position:"static",zIndex:"auto"}),t.$tallyBar.css({position:"static",zIndex:"auto"});break;default:t.$tallyText.text(t._buildText())}t._updateClasses(e),s.showProgressBar&&t._updateProgressBar()})},_updateProgressBar:function(){this.$tallyBar.css("background-width",this._getPercentage()+"%")},_fireEvent:function(t){var s="warning"===t?"tallyWarning":"tallyPass";this.$tally.hasClass(this.options.warningClass)&&this.$el.trigger(s)},_updateClasses:function(s){var e=s.target,i=s.type;this.options.textfield.warnAt>=this._countChars()?(t(e).addClass(this.options.textfield.warningClass),this.$tally.addClass(this.options.warningClass),this._fireEvent("warning")):(t(e).removeClass(this.options.textfield.warningClass),this.$tally.removeClass(this.options.warningClass),this._fireEvent("pass")),"focusout"===i&&t(e).removeClass(this.options.textfield.warningClass)},_buildText:function(){var t=this.options.tallyPattern,s=this._countWords(),e=this._pad(this._countChars()),i=this._getPercentage(e,this.options.textfield.maxlength);return t.replace("{{c}}",e).replace("{{m}}",this.options.textfield.maxlength).replace("{{w}}",s).replace("{{p}}",this._pad(i,3))},_countChars:function(){return this.options.textfield.maxlength-this.$el.val().length},_getPercentage:function(t,s){return 100-parseInt(Math.floor(100*(t/s)),10)},_countWords:function(){var t=this.$el.val();return t.match(/\S+/g)?t.match(/\S+/g).length:t?1:0},_buildTallyObject:function(){var s,e,i=this.options,a=t("#"+i.tallyID);this._initialized||0!==a.length?(this.$tally=a,this.$tallyText=a.find("."+i.textClass),this.$tallyBar=a.find("."+i.progressBarClass)):(s=t("<div/>",{id:i.tallyID}).hide(),this.$tally=s,e=t("<span/>",{"class":i.progressBarClass,display:"block"}),e.appendTo(s),this.$tallyBar=e,e=t("<span/>",{"class":i.textClass,display:"block"}).appendTo(s),s.appendTo("body"),this.$tallyText=e,this._initialized=!0)},_setXY:function(){var t=0,s=0,e=this.options.position.x,i=this.options.position.y,a=parseInt(this.options.position.offsetX,10),l=parseInt(this.options.position.offsetY,10),n=this.$el.offset().left,o=this.$el.width(),r=this.$el.offset().top,h=this.$el.height(),p=this.$tally.outerWidth(),c=this.$tally.outerHeight();switch(e){case"left":t=n;break;case"center":t=n+o/2-p/2;break;case"right":t=n+o-p+6;break;default:t=parseInt(e,10)}switch(i){case"top":s=r-c-8;break;case"center":s=r+h/2-c/2;break;case"bottom":s=r+h+7;break;default:s=parseInt(i,10)}"left"===e&&"center"===i&&(t-=p+13),"right"===e&&"center"===i&&(t+=p+12),"number"==typeof a&&(t+=parseInt(a,10)),"number"==typeof l&&(s+=parseInt(l,10)),this.$tally.css({top:s,left:t})},_pad:function(t,s,e){for(s=s||this.options.textfield.maxlength.length,e=e||0,t+="";s>t.length;)t=e+t;return t}},jQuery.fn.tally=function(e){if("string"!=typeof e)return this.each(function(){new s(t(this),e)});if(s=t(this).data("Tally"),null!==s)switch(e){case"init":s.init();break;case"destroy":s.destroy()}},jQuery.fn.tally.defaults={tallyID:"tallyID",tallyClass:"tally",textClass:"tally-text",tallyPattern:"{{c}}/{{m}}",warningClass:"tally-warningClass",showProgressBar:!0,progressBarClass:"tally-progressBar",textfield:{warnAt:10,maxlength:256,warningClass:"tally-txtWarningClass"},setPosition:!0,position:{zIndex:100,x:"right",y:"bottom",offsetX:0,offsetY:0}}})(jQuery);