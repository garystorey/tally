!function(t){"use strict";var s=function(s,i){this.el=s,this.$el=t(s),this._initialized=!1,this.init(i)};s.prototype={init:function(t){return this.type="Tally",this._setOptions(t),this.count=0,this.remaining=0,this.max=0,this.percent=0,this.x=0,this.y=0,this._events="focusin.tally focusout.tally keyup.tally input.tally paste.tally",this._buildTallyObject(),this._bindEvents(),this.$el.data("Tally",this),this.$el},destroy:function(){this._initialized&&(this.$tally.remove(),this.$tally=void 0,this.$el.off(".tally"))},_setOptions:function(s){var i,e=this.$el.data("tally"),n=this.$el.attr("maxlength");this.options=t.extend(!0,{},t.fn.tally.defaults,s),e&&(this.options=t.extend(!0,{},this.options,e)),i=this.options,this.options.maxlength=n?n-0:i.maxlength-0,this.options.countDirection=i.countDirection.toLowerCase(),-1==="updown".indexOf(i.countDirection)&&(this.options.countDirection="up")},_updateTally:function(t){var s=this.options,i="focusout"===t?"static":"relative",e="focusout"===t?"static":"absolute";this.$tally.css({position:e,zIndex:s.position.zIndex}),this.$tallyBar.css({position:i,zIndex:s.position.zIndex+1}),this.$tallyText.css({position:i,zIndex:s.position.zIndex+2}),this._setXY()},_bindEvents:function(){var t=this,s=t.options,i=t._events,e=t.$tallyText;t.$el.on(i,function(i){e.text("focusout"===i.type?"":t._buildText()),t._updateClasses(i),s.showProgressBar&&t._updateProgressBar(),s.setPosition&&t._updateTally(i.type)})},_updateProgressBar:function(){this.$tallyBar.css("background-width",this._getPercentage()+"%")},_fireEvent:function(t){this.$el.trigger("warning"===t?"tallyWarning":"tallyPass")},_hasWarning:function(){return this.$tally.hasClass(this.options.classes.warning)},_updateClasses:function(s){var i,e=this,n=e.$tally,a=t(s.target),l=s.type,o=this.options,r=o.classes.field,h=o.warnAt,c=o.countDirection,p=this._countChars(),u=o.maxlength;l.indexOf("focus")>-1&&(e._setClasses(n,"add"),"focusin"===l?n.addClass(o.classes.main).show():(n.removeClass(o.classes.main+" "+o.classes.warning).hide(),a.removeClass(r))),this._fireEvent(this._hasWarning()?"pass":"warning"),i="up"===c?u-h>p:p>h,this._setClasses(a,i?"remove":"add")},_setClasses:function(t,s){var i=this.options.classes;s="add"===s?"addClass":"removeClass",t[s](i.field),this.$tally[s](i.warning)},_buildText:function(){var t=this.options,s=t.pattern,i=t.maxlength,e=this._countWords(),n=this._pad(this._countChars()),a=this._getPercentage(n,i),l=i-n;return s=s.replace("{{c}}",n).replace("{{m}}",i).replace("{{r}}",l).replace("{{w}}",e).replace("{{p}}",this._pad(a,3),"")},_countChars:function(){var t=this.$el.val().length,s=this.options;return"down"===s.countDirection?s.maxlength-t:t},_getPercentage:function(t,s){var i=parseInt(Math.floor(t/s*100),10);return"down"===this.options.countDirection?100-i:i},_countWords:function(){var t=this.$el.val();return t.match(/\S+/g)?t.match(/\S+/g).length:t?1:0},_buildTallyObject:function(){var s,i,e=this.options,n=t("#"+e.id);this._initialized||0!==n.length?(this.$tally=n,this.$tallyText=n.find("."+e.classes.text),this.$tallyBar=n.find("."+e.classes.progressBar)):(s=t("<div/>",{id:e.id}).hide(),this.$tally=s,i=t("<span/>",{"class":e.classes.progressBar,display:"block"}),i.appendTo(s),this.$tallyBar=i,i=t("<span/>",{"class":e.classes.text,display:"block"}).appendTo(s),s.appendTo("body"),this.$tallyText=i,this._initialized=!0)},_setXY:function(){var t=0,s=0,i=this.options.position,e=i.x,n=i.y,a=parseInt(i.offsetX,10),l=parseInt(i.offsetY,10),o=this.$el.offset().left,r=this.$el.width(),h=this.$el.offset().top,c=this.$el.height(),p=this.$tally.outerWidth(),u=this.$tally.outerHeight();switch(e){case"left":t=o;break;case"center":t=o+r/2-p/2;break;case"right":t=o+r-p+6;break;default:t=parseInt(e,10)}switch(n){case"top":s=h-u-8;break;case"center":s=h+c/2-u/2;break;case"bottom":s=h+c+7;break;default:s=parseInt(n,10)}"left"===e&&"center"===n&&(t-=p+13),"right"===e&&"center"===n&&(t+=p+12),"number"==typeof a&&(t+=parseInt(a,10)),"number"==typeof l&&(s+=parseInt(l,10)),this.$tally.css({top:s,left:t})},_pad:function(t,s,i){var e=this.options.maxlength+"";for(s=s||e.length,i=i||"0",t+="";t.length<s;)t=i+t;return t}},jQuery.fn.tally=function(i){if("string"!=typeof i)return this.each(function(){new s(t(this),i)});if(s=t(this).data("Tally"),null!==s)switch(i){case"init":s.init();break;case"destroy":s.destroy()}},jQuery.fn.tally.defaults={id:"tally",pattern:"{{c}}/{{m}}",showProgressBar:!0,warnAt:10,maxlength:256,countDirection:"up",classes:{main:"tally",text:"tally-text",progressBar:"tally-progressBar",warning:"tally-warning",field:"tally-fieldWarning"},setPosition:!0,position:{zIndex:100,x:"right",y:"bottom",offsetX:0,offsetY:0}}}(jQuery);